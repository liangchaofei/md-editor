# 项目开发计划

## 项目概述

企业级多人协同富文本编辑器 - 从零到一的完整实现教程

**技术栈：**
- 前端：React 18 + TypeScript + Vite + Tailwind CSS + Tiptap + Y.js + Zustand
- 后端：Node.js + TypeScript + Koa2 + Hocuspocus + SQLite + DeepSeek API
- AI：OpenAI SDK + Server-Sent Events + Markdown 渲染

**总章节：** 26 章
**已完成：** 23 章
**进度：** 88%

---

## 开发进度

### 阶段一：项目初始化（Chapter 1-3）

#### ✅ Chapter 1: 项目脚手架搭建
**状态：** 已完成 ✓  
**Commit：** `feat: 初始化项目结构和基础配置`  
**完成时间：** 2024-01-28

**实现内容：**
- [x] 创建 Monorepo 结构（client + server）
- [x] 配置 pnpm workspace
- [x] 配置 Vite + React + TypeScript 前端项目
- [x] 配置 Koa2 + TypeScript 后端项目
- [x] 集成 Tailwind CSS 样式框架
- [x] 配置 ESLint 和 Prettier 代码规范
- [x] 创建项目目录结构
- [x] 编写 Chapter 1 教程文档

**核心知识点：**
- Monorepo 架构设计
- pnpm workspace 使用
- Vite 工作原理
- Koa2 洋葱模型
- TypeScript 严格模式
- Tailwind CSS 按需加载

**面试考点：**
- Monorepo vs Polyrepo
- Vite vs Webpack 性能对比
- Koa 洋葱模型实现原理
- TypeScript strict 模式

---

#### ✅ Chapter 2: 后端基础架构与数据库
**状态：** 已完成 ✓  
**Commit：** `feat: 搭建后端基础架构和数据库`  
**完成时间：** 2024-01-28

**实现内容：**
- [x] 集成 SQLite 数据库
- [x] 设计 documents 表结构
- [x] 创建数据库索引
- [x] 实现统一的 API 响应格式
- [x] 添加错误处理中间件
- [x] 添加日志中间件
- [x] 实现优雅关闭机制
- [x] 完善 TypeScript 类型定义
- [x] 编写 Chapter 2 教程文档

**核心知识点：**
- SQLite 在 Node.js 中的使用
- 数据库表设计最佳实践
- 软删除机制
- 统一响应格式设计
- Koa 中间件实战

**面试考点：**
- ACID 特性
- 数据库索引原理
- 中间件执行顺序
- 软删除 vs 硬删除

---

#### ✅ Chapter 3: 前端基础布局
**状态：** 已完成 ✓  
**Commit：** `feat: 实现应用整体布局框架`  
**完成时间：** 2024-01-28

**实现内容：**
- [x] 创建 Layout 组件（三栏布局）
- [x] 实现响应式设计
- [x] 创建 Header 组件
- [x] 创建 Sidebar 组件
- [x] 创建 Editor 区域
- [x] 编写 Chapter 3 教程文档

**核心知识点：**
- Flexbox vs Grid 布局
- React 组件设计模式
- Tailwind 响应式设计
- 组件拆分原则

**面试考点：**
- Flexbox 布局原理
- React 组件通信方式
- 响应式设计实现
- CSS 变量的使用

---

### 阶段二：文档管理功能（Chapter 4-7）

#### ✅ Chapter 4: 文档 CRUD API
**状态：** 已完成 ✓  
**Commit：** `feat: 实现文档增删改查 API`  
**完成时间：** 2024-01-28

**实现内容：**
- [x] 创建 documents 路由模块
- [x] 实现 GET /api/documents（列表查询）
- [x] 实现 POST /api/documents（创建文档）
- [x] 实现 GET /api/documents/:id（获取单个文档）
- [x] 实现 PUT /api/documents/:id（更新文档）
- [x] 实现 DELETE /api/documents/:id（软删除）
- [x] 编写 Chapter 4 教程文档

**核心知识点：**
- RESTful API 设计规范
- SQL 查询优化
- 参数验证
- 错误处理最佳实践

**面试考点：**
- RESTful API 设计原则
- SQL 注入防护
- 分页实现方式
- 事务处理

---

#### ✅ Chapter 5: Zustand 状态管理
**状态：** 已完成 ✓  
**Commit：** `feat: 集成 Zustand 状态管理`  
**完成时间：** 2024-01-28

**实现内容：**
- [x] 安装 Zustand 和 axios
- [x] 创建 useDocumentStore
- [x] 实现文档 CRUD actions
- [x] 集成 axios 请求
- [x] 编写 Chapter 5 教程文档

**核心知识点：**
- Zustand 基础用法
- 状态管理最佳实践
- 异步状态处理
- TypeScript 类型推导

**面试考点：**
- Zustand vs Redux 对比
- 状态管理设计模式
- 异步状态处理方案
- 性能优化技巧

---

#### ✅ Chapter 6: 左侧文档列表 UI
**状态：** 已完成 ✓  
**Commit：** `feat: 实现左侧文档列表界面`  
**完成时间：** 2024-01-28

**实现内容：**
- [x] 完善 Sidebar 组件
- [x] 实现文档列表渲染
- [x] 实现新建文档按钮
- [x] 实现文档项组件
- [x] 实现搜索框
- [x] 编写 Chapter 6 教程文档

**核心知识点：**
- 列表渲染优化
- Tailwind 动态样式
- 用户体验细节
- 组件状态管理

**面试考点：**
- React 列表渲染优化
- 虚拟滚动原理
- 防抖和节流
- CSS 动画性能

---

#### ✅ Chapter 7: 文档操作功能
**状态：** 已完成 ✓  
**Commit：** `feat: 实现文档的新增、重命名、删除`  
**完成时间：** 2024-01-28

**实现内容：**
- [x] 实现新建文档功能
- [x] 实现文档重命名
- [x] 实现删除确认弹窗
- [x] 实现右键菜单
- [x] 实现搜索过滤功能
- [x] 编写 Chapter 7 教程文档

**核心知识点：**
- Headless UI 使用
- 受控组件 vs 非受控组件
- 用户交互设计
- 防抖优化

**面试考点：**
- 受控组件原理
- 事件委托
- 拖拽实现原理
- 性能优化方案

---

### 阶段三：基础编辑器（Chapter 8-10）

#### ✅ Chapter 8: Tiptap 编辑器集成
**状态：** 已完成 ✓  
**Commit：** `feat: 集成 Tiptap 基础编辑器`  
**完成时间：** 2024-01-29

**计划内容：**
- [ ] 安装 Tiptap 相关依赖
- [ ] 创建 Editor 组件
- [ ] 集成 StarterKit 扩展
- [ ] 实现基础文本编辑
- [ ] 实现内容保存
  - [ ] 自动保存（防抖）
  - [ ] 保存状态指示
- [ ] 实现内容加载
- [ ] 编写 Chapter 8 教程文档

**核心知识点：**
- Tiptap 架构原理
- ProseMirror 基础概念
- 扩展系统介绍
- 编辑器生命周期

**面试考点：**
- 富文本编辑器原理
- contenteditable 属性
- Selection API
- 编辑器性能优化

---

#### ✅ Chapter 9: 编辑器工具栏
**状态：** 已完成 ✓  
**Commit：** `feat: 实现编辑器工具栏（固定工具栏和浮动工具栏）`  
**完成时间：** 2024-01-29

**计划内容：**
- [ ] 创建浮动工具栏组件
  - [ ] 选中文字时显示
  - [ ] 定位算法
  - [ ] 动画效果
- [ ] 实现格式化按钮
  - [ ] 加粗（Bold）
  - [ ] 斜体（Italic）
  - [ ] 下划线（Underline）
  - [ ] 删除线（Strike）
- [ ] 实现标题按钮（H1-H6）
- [ ] 实现列表按钮
  - [ ] 无序列表
  - [ ] 有序列表
- [ ] 实现链接插入
- [ ] 创建顶部菜单栏（可选）
- [ ] 编写 Chapter 9 教程文档

**核心知识点：**
- 浮动工具栏定位算法
- Tiptap 命令系统
- 工具栏状态同步
- 自定义扩展开发

**面试考点：**
- 元素定位算法
- Range 和 Selection
- 命令模式
- 状态管理

---

#### ✅ Chapter 10: 编辑器样式优化
**状态：** 已完成 ✓  
**Commit：** `feat: 实现编辑器样式优化和用户体验增强`  
**完成时间：** 2024-01-29

**实现内容：**
- [x] 添加占位符提示
- [x] 实现字数统计
- [x] 创建编辑器状态栏
- [x] 集成自动保存指示器
- [x] 优化排版样式
- [x] 完善焦点管理
- [x] 编写 Chapter 10 教程文档

**核心知识点：**
- Tiptap 扩展系统
- Placeholder 扩展使用
- CharacterCount 扩展使用
- 防抖优化
- 用户体验设计

**面试考点：**
- 防抖和节流实现
- 扩展系统设计
- 状态管理
- 性能优化

---

### 阶段四：协同编辑核心（Chapter 11-14）

#### ✅ Chapter 11: Y.js 基础集成
**状态：** 已完成 ✓  
**Commit：** `feat: 集成 Y.js 实现基础协同编辑`  
**完成时间：** 2024-01-29

**实现内容：**
- [x] 安装 Y.js 和相关依赖
- [x] 创建 Y.Doc 实例
- [x] 集成 Collaboration 扩展
- [x] 实现本地多窗口同步
- [x] 实现 IndexedDB 持久化
- [x] 集成 Y.js UndoManager
- [x] 编写 Chapter 11 教程文档

**核心知识点：**
- CRDT 算法原理
- Y.js 核心概念
- Shared Types 介绍
- 本地数据持久化
- UndoManager 使用

**面试考点：**
- CRDT vs OT 算法
- 冲突解决机制
- 数据同步策略
- 离线编辑支持

---

#### ✅ Chapter 12: Hocuspocus 服务器
**状态：** 已完成 ✓  
**Commit：** `feat: 搭建 Hocuspocus WebSocket 服务器实现实时协同`  
**完成时间：** 2024-01-29

**实现内容：**
- [x] 安装 Hocuspocus Server
- [x] 配置 WebSocket 服务
- [x] 集成数据库持久化扩展
- [x] 实现文档加载和保存
- [x] 前端连接 WebSocket 服务器
- [x] 实现跨设备实时同步
- [x] 编写 Chapter 12 教程文档

**核心知识点：**
- WebSocket 原理
- Hocuspocus 架构
- 扩展系统使用
- 数据持久化策略
- 实时同步机制

**面试考点：**
- WebSocket vs HTTP
- 长连接管理
- 心跳机制
- 数据同步策略

---

#### ✅ Chapter 13: 协同状态和连接管理
**状态：** 已完成 ✓  
**Commit：** `feat: 实现协同状态管理和连接指示`  
**完成时间：** 2024-01-29

**实现内容：**
- [x] 创建 useCollaborationStatus Hook
- [x] 实现连接状态指示器
- [x] 实现在线用户数显示
- [x] 实现离线编辑提示
- [x] 实现重连提示
- [x] 配置自动重连机制
- [x] 编写 Chapter 13 教程文档

**核心知识点：**
- Provider 配置详解
- 连接状态处理
- 错误处理和重连
- 离线编辑支持

**面试考点：**
- WebSocket 连接管理
- 断线重连策略
- 状态同步机制
- 错误处理

---

#### ✅ Chapter 14: 协作光标和用户信息
**状态：** 已完成 ✓  
**Commit：** `feat: 实现自定义协作光标和在线用户显示`  
**完成时间：** 2024-01-29

**实现内容：**
- [x] 创建自定义 CollaborationCursor 扩展
- [x] 实现用户颜色分配
- [x] 显示用户名标签
- [x] 实现在线用户列表
- [x] 实现光标和选区显示
- [x] 编写 Chapter 14 教程文档

**核心知识点：**
- 协作光标原理
- Awareness 状态管理
- 用户信息同步
- UI 交互设计

**面试考点：**
- Awareness 机制
- 光标定位算法
- 颜色分配策略
- 性能优化

---

### 阶段五：高级功能（Chapter 15-18）

#### ✅ Chapter 15: 编辑器快捷键和斜杠命令
**状态：** 已完成 ✓  
**Commit：** `feat: 实现编辑器快捷键和斜杠命令菜单`  
**完成时间：** 2024-01-29

**实现内容：**
- [x] 创建自定义快捷键扩展
- [x] 实现基础格式化快捷键
- [x] 实现标题和列表快捷键
- [x] 创建斜杠命令扩展
- [x] 实现命令列表组件
- [x] 实现模糊搜索和键盘导航
- [x] 编写 Chapter 15 教程文档

**核心知识点：**
- Tiptap 快捷键系统
- Suggestion 扩展原理
- Tippy.js 定位
- 命令模式设计

**面试考点：**
- 快捷键系统设计
- 事件处理优先级
- 命令模式
- 用户体验优化

---

#### ✅ Chapter 16: 文档导出功能
**状态：** 已完成 ✓  
**Commit：** `feat: 实现文档导出功能（Markdown、HTML、纯文本、打印）`  
**完成时间：** 2024-01-29

**实现内容：**
- [x] 实现导出为 Markdown
- [x] 实现导出为 HTML
- [x] 实现导出为纯文本
- [x] 实现复制为富文本
- [x] 实现打印功能
- [x] 创建导出菜单组件
- [x] 编写 Chapter 16 教程文档

**核心知识点：**
- Tiptap 内容转换
- Markdown 序列化
- HTML 导出
- 文件下载实现
- 剪贴板 API

**面试考点：**
- 内容序列化
- 文件下载方案
- 剪贴板操作
- 打印样式优化

---

#### ✅ Chapter 17: 富文本增强功能
**状态：** 已完成 ✓  
**Commit：** `feat: 添加表格、图片、任务列表、代码高亮等高级功能`  
**完成时间：** 2024-01-29

**实现内容：**
- [x] 集成 Table 扩展（插入表格、添加/删除行列）
- [x] 集成 Image 扩展（本地上传、Base64 编码）
- [x] 集成 TaskList 扩展（任务列表、勾选状态）
- [x] 增强代码块（语法高亮、多语言支持）
- [x] 创建 TableMenu 组件
- [x] 创建 ImageUpload 组件
- [x] 编写 Chapter 17 教程文档

**核心知识点：**
- Tiptap 扩展生态
- 文件上传处理
- 代码高亮实现
- 表格编辑器

**面试考点：**
- 文件上传方案
- 图片压缩
- 语法高亮原理
- 表格数据结构

---

#### ✅ Chapter 18: 文档历史版本
**状态：** 已完成 ✓  
**Commit：** `feat: 实现文档历史版本功能和用户体验优化`  
**完成时间：** 2024-01-29

**实现内容：**
- [x] 设计版本表结构
- [x] 实现版本 CRUD API
- [x] 创建历史版本列表组件
- [x] 实现版本恢复功能
- [x] 实现版本删除功能
- [x] 优化页面布局（Flexbox）
- [x] 实现默认选中第一个文档
- [x] 实现侧边栏展开/收起功能
- [x] 编写 Chapter 18 教程文档

**核心知识点：**
- 版本控制策略
- 快照存储优化
- 数据恢复机制
- 用户体验优化

**面试考点：**
- 版本控制原理
- 数据压缩
- 存储优化
- 布局优化技巧

---

### 阶段六：AI 写作助手（Chapter 19-24）

#### ✅ Chapter 19: 编辑器区域分栏 - 为 AI 对话预留空间
**状态：** 已完成 ✓  
**Commit：** `feat: 编辑器区域调整为左右分栏，右侧添加 AI 对话面板`  
**完成时间：** 2024-01-29

**实现内容：**
- [x] 保持现有三栏布局（文档列表 + 编辑器 + AI 对话）
- [x] 将编辑器区域（中间部分）拆分为左右两部分
  - [x] 左侧：富文本编辑器（占编辑器区域的 60%）
  - [x] 右侧：AI 对话面板（占编辑器区域的 40%）
- [x] 实现编辑器和 AI 面板之间的拖拽调整
- [x] 实现 AI 面板的展开/收起功能
- [x] 添加 AI 助手按钮
- [x] 优化响应式布局
- [x] 编写 Chapter 19 教程文档

**布局说明**：
```
完整布局（三栏）：
┌────────┬──────────────────────────┬─────────────┐
│ 文档列表 │    编辑器区域（拆分）      │             │
│        │  ┌──────────┬──────────┐ │             │
│ Sidebar│  │  Editor  │ AI Chat  │ │             │
│        │  │          │          │ │             │
│ (可收起)│  │  (60%)   │  (40%)   │ │             │
│        │  └──────────┴──────────┘ │             │
└────────┴──────────────────────────┴─────────────┘
```

**核心知识点：**
- 嵌套 Flexbox 布局
- 拖拽调整宽度实现
- 组件状态管理
- 响应式设计

**面试考点：**
- CSS Flexbox 嵌套
- 拖拽事件处理
- 布局性能优化
- 用户体验设计

---

#### ✅ Chapter 20: DeepSeek API 集成
**状态：** 已完成 ✓  
**Commit：** `feat: 集成 DeepSeek API 实现流式对话`  
**完成时间：** 2024-01-29

**实现内容：**
- [x] 安装 OpenAI SDK 和 dotenv
- [x] 创建 AI 配置管理（支持环境变量，运行时读取）
- [x] 实现后端 AI 代理路由（/api/ai/chat）
- [x] 实现流式响应处理（SSE）
- [x] 创建前端 AI API 客户端
- [x] 实现错误处理和验证
- [x] 编写 Chapter 20 教程文档
- [x] 修复环境变量加载时序问题

**核心知识点：**
- OpenAI API 兼容接口
- Server-Sent Events (SSE)
- API 密钥安全管理
- 流式数据处理
- 错误处理策略

**面试考点：**
- SSE vs WebSocket 对比
- 流式数据传输原理
- API 安全最佳实践
- 代理模式应用

---

#### ✅ Chapter 21: AI 对话界面基础
**状态：** 已完成 ✓  
**Commit：** `feat: 实现 AI 对话界面和深度思考模式`  
**完成时间：** 2024-01-29

**实现内容：**
- [x] 创建 AIChatPanel 组件（完整版）
- [x] 实现消息列表展示（用户消息 + AI 回复）
- [x] 实现输入框和发送按钮
- [x] 实现"正在思考中"加载状态
- [x] 集成 react-markdown 渲染 Markdown
- [x] 集成 rehype-highlight 代码高亮
- [x] 实现消息时间戳显示
- [x] 实现自动滚动到最新消息
- [x] 支持 Enter 发送，Shift+Enter 换行
- [x] 创建 Message 类型定义
- [x] 添加模型选择功能（chat/reasoner）
- [x] 实现深度思考模式（DeepSeek Reasoner）
- [x] 显示思考过程（可折叠）
- [x] 优化思考过程和正文的视觉区分
- [x] 修复双重 JSON 编码问题
- [x] 编写 Chapter 21 教程文档

**核心知识点：**
- React 组件设计
- 消息列表渲染
- Markdown 渲染
- 加载状态管理

**面试考点：**
- 列表渲染优化
- Markdown 解析原理
- 组件状态管理
- 用户体验设计

---

#### ⏳ Chapter 22: 流式输出到编辑器（核心功能）
**状态：** 待开始  
**Commit：** `feat: 实现 AI 生成内容流式输出到编辑器`  
**预计时间：** 4-5 小时

**计划内容：**
- [ ] 实现 AI 流式响应监听（SSE 事件处理）
- [ ] 实现双向同步流式输出
  - [ ] 右侧 AI 对话面板逐字显示
  - [ ] 左侧编辑器同步流式输出
- [ ] 实现"思考中"状态
  - [ ] 右侧显示"正在思考中"加载动画
  - [ ] 左侧编辑器底部显示"思考中..."按钮
- [ ] 实现生成过程控制
  - [ ] 停止生成按钮（中断 SSE 连接）
  - [ ] 生成进度指示（已生成字数）
- [ ] 实现生成完成状态
  - [ ] 显示"内容生成完成"提示卡片
  - [ ] 提供操作按钮：继续生成、重新生成、撤销
- [ ] 实现撤销生成内容功能
- [ ] 优化流式输出性能（requestAnimationFrame + 防抖）
- [ ] 编写 Chapter 22 教程文档

**实现流程（对应原型图）：**
1. **初始状态**：左侧空白编辑器，右侧输入框
2. **用户输入**：在右侧输入需求并发送
3. **思考状态**：右侧显示"正在思考中"，左侧显示"思考中..."
4. **流式生成**：右侧和左侧同步逐字显示内容
5. **完成状态**：显示完整内容和操作按钮

**核心知识点：**
- Tiptap 命令系统
- 流式内容插入策略
- 双向同步机制
- 编辑器状态管理
- 性能优化技巧

**面试考点：**
- 富文本编辑器命令
- 流式渲染优化
- 撤销/重做实现
- 防抖和节流
- SSE 事件处理

---

#### ✅ Chapter 23: AI 快捷指令 - 改写功能
**状态：** 已完成 ✓  
**Commit：** `feat: 实现 AI 改写快捷指令（浮动菜单触发）`  
**完成时间：** 2024-01-30

**实现内容：**
- [x] 创建 Highlight 扩展（支持临时高亮）
- [x] 定义 AI 指令类型（AICommandType）
- [x] 实现前端 executeAICommand API
- [x] 实现后端 /api/ai/command 路由
- [x] 创建 AICommandDialog 对话框组件
- [x] 创建 BubbleMenu 浮动菜单组件
- [x] 实现改写功能（选中文本 → 浮动菜单 → 对话框 → AI 生成 → 替换）
- [x] 实现临时高亮（不持久化到数据库）
- [x] 实现点击取消高亮
- [x] 修复浮动菜单重复显示问题
- [x] 修复选区丢失问题
- [x] 编写 Chapter 23 教程文档

**核心知识点：**
- Tiptap Mark 扩展开发
- 浮动菜单定位算法
- 选区操作和内容替换
- CSS 临时高亮实现
- Prompt Engineering
- 流式响应处理

**面试考点：**
- Mark vs Node 区别
- 浮动元素定位
- 选区 API 使用
- 事件处理优化

---

#### ⏳ Chapter 24: AI 对话式文档编辑（核心创新功能）
**状态：** 待开始  
**Commit：** `feat: 实现 AI 对话式文档编辑和智能修改建议`  
**预计时间：** 6-8 小时

**计划内容：**
- [ ] 创建 Suggestion Mark 扩展（修改建议标记）
- [ ] 定义修改建议类型（SuggestedChange）
- [ ] 实现文本匹配算法（textMatcher.ts）
- [ ] 创建 SuggestionManager 组件（管理所有修改建议）
- [ ] 创建 SuggestionTooltip 组件（接受/拒绝按钮）
- [ ] 扩展 AIChatPanel 支持修改建议
- [ ] 实现后端结构化返回（JSON 格式的修改建议）
- [ ] 实现 AI 定位和替换逻辑
- [ ] 实现流式显示修改过程
- [ ] 实现 hover 显示 tooltip
- [ ] 实现接受/拒绝修改
- [ ] 实现多处修改管理
- [ ] 编写 Chapter 24 教程文档

**实现流程（对应设计图）：**
1. 用户在 AI 对话框输入："把第四章节标题改为'涵盖技术领域内容'"
2. AI 思考并返回结构化修改建议
3. 编辑器中流式显示修改（蓝色高亮）
4. 鼠标 hover 显示 tooltip（接受/拒绝按钮）
5. 点击接受后替换原文

**核心知识点：**
- AI 结构化输出
- 文本模糊匹配算法
- Tiptap Decoration API
- Tooltip 定位和交互
- 多状态管理

**面试考点：**
- 字符串匹配算法
- Diff 算法原理
- 状态机设计
- 用户体验优化

---

#### ⏳ Chapter 25: 扩展更多 AI 快捷指令
**状态：** 待开始  
**Commit：** `feat: 实现续写、扩写、总结、翻译等 AI 指令`  
**预计时间：** 3-4 小时

**计划内容：**
- [ ] 实现续写功能（根据上文继续写作）
- [ ] 实现扩写功能（详细展开选中内容）
- [ ] 实现总结功能（概括总结选中内容）
- [ ] 实现翻译功能（中英文互译）
- [ ] 扩展 BubbleMenu 添加更多按钮
- [ ] 优化 Prompt 模板
- [ ] 编写 Chapter 25 教程文档

**核心知识点：**
- 不同场景的 Prompt 设计
- 上下文提取策略
- 批量指令处理

**面试考点：**
- Prompt Engineering 最佳实践
- 上下文窗口优化
- 策略模式应用

---

#### ⏳ Chapter 26: AI 功能优化和增强
**状态：** 待开始  
**Commit：** `feat: AI 功能优化、对话历史、模型切换`  
**预计时间：** 4-5 小时

**计划内容：**
- [ ] 实现对话历史管理（保存和加载）
- [ ] 实现多模型切换（DeepSeek、GPT-4 等）
- [ ] 实现 Token 使用统计和显示
- [ ] 实现 AI 响应缓存
- [ ] 实现请求队列管理
- [ ] 实现快捷键触发 AI（Ctrl+K）
- [ ] 实现右键菜单 AI 选项
- [ ] 性能优化和错误处理
- [ ] 编写 Chapter 26 教程文档

**核心知识点：**
- 对话历史持久化
- 多模型适配
- 缓存策略
- 性能监控

**面试考点：**
- 缓存设计
- 队列实现
- 性能优化方案
- 用户体验设计

---

### ~~阶段六：优化和部署（Chapter 19-20）~~

#### ~~⏳ Chapter 19: 性能优化和测试~~
**状态：** 已删除（改为 AI 功能）  
~~**Commit：** `feat: 性能优化和单元测试`~~

---

#### ~~⏳ Chapter 20: 生产环境配置和部署~~
**状态：** 已删除（改为 AI 功能）  
~~**Commit：** `feat: 生产环境配置和部署指南`~~

---

## 项目统计

### 时间估算
- 总预计时间：95-115 小时
- 已完成时间：~62 小时
- 剩余时间：~33-53 小时

### 代码量估算
- 前端代码：~9000 行
- 后端代码：~3800 行
- AI 集成代码：~2500 行
- 配置文件：~500 行
- 总计：~15800 行

### 文件数量
- 前端组件：~50 个
- 后端路由：~20 个
- 工具函数：~32 个
- AI 相关模块：~15 个
- 总计：~117 个文件

---

## 学习路径建议

### 初学者路径（完整学习）
按顺序完成所有 26 章，预计 3-4 个月

### 进阶路径（核心功能）
- Chapter 1-2：项目搭建
- Chapter 4-5：文档管理
- Chapter 8-9：基础编辑器
- Chapter 11-13：协同编辑
- Chapter 19-24：AI 集成
- 预计 2-2.5 个月

### AI 写作助手路径（重点功能）
- Chapter 1-2：项目搭建
- Chapter 8：基础编辑器
- Chapter 19：布局调整
- Chapter 20：DeepSeek API 集成
- Chapter 21：AI 对话界面
- Chapter 22：流式输出到编辑器
- Chapter 23：AI 改写快捷指令
- Chapter 24：AI 对话式文档编辑（核心创新）
- 预计 4-5 周

### 面试准备路径（重点章节）
- Chapter 1：架构设计
- Chapter 2：数据库设计
- Chapter 5：状态管理
- Chapter 11：协同编辑原理
- Chapter 20：AI API 集成
- Chapter 22：流式数据处理
- Chapter 23：快捷指令系统
- Chapter 24：AI 对话式编辑（创新点）
- 预计 2-3 周

---

## 更新日志

### 2024-01-30
- ✅ 完成 Chapter 23：AI 改写快捷指令
  - 实现浮动菜单（BubbleMenu）
  - 实现 AI 指令对话框（AICommandDialog）
  - 实现临时高亮（不持久化）
  - 修复浮动菜单重复显示问题
  - 修复选区丢失问题
  - 修复高亮持久化问题
- 📝 更新项目开发计划
  - 调整章节规划：23章改写 + 24章对话式编辑 + 25章更多指令 + 26章优化
  - 新增 Chapter 24：AI 对话式文档编辑（核心创新功能）
- 🎯 准备开始 Chapter 24：AI 对话式文档编辑

### 2024-01-29（下午）
- ✅ 完成 Chapter 19：编辑器区域分栏
- ✅ 完成 Chapter 20：DeepSeek API 集成
- ✅ 完成 Chapter 21：AI 对话界面和深度思考模式
- 🎯 准备开始 Chapter 22：流式输出到编辑器（核心功能）

### 2024-01-29（上午）
- ✅ 完成 Chapter 8：Tiptap 编辑器集成
- ✅ 完成 Chapter 9：编辑器工具栏
- ✅ 完成 Chapter 10：编辑器样式优化
- ✅ 完成 Chapter 11：Y.js 基础集成
- ✅ 完成 Chapter 12：Hocuspocus 服务器
- ✅ 完成 Chapter 13：协同状态和连接管理
- ✅ 完成 Chapter 14：协作光标和用户信息
- ✅ 完成 Chapter 15：编辑器快捷键和斜杠命令
- ✅ 完成 Chapter 16：文档导出功能
- ✅ 完成 Chapter 17：富文本增强功能
- ✅ 完成 Chapter 18：文档历史版本和用户体验优化
- 📝 更新项目开发计划（删除 19-20 章，新增 AI 写作助手功能）
- 🎯 项目定位调整：协同编辑器 → AI 写作协同编辑器

### 2024-01-28
- ✅ 完成 Chapter 1：项目脚手架搭建
- ✅ 完成 Chapter 2：后端基础架构与数据库
- ✅ 完成 Chapter 3：前端基础布局
- ✅ 完成 Chapter 4：文档 CRUD API
- ✅ 完成 Chapter 5：Zustand 状态管理
- ✅ 完成 Chapter 6：左侧文档列表 UI
- ✅ 完成 Chapter 7：文档操作功能
- 📝 创建项目开发计划文档

---

## 项目特色

### 🎯 核心功能
1. **实时协同编辑**：基于 Y.js CRDT 算法，支持多人实时协作
2. **AI 写作助手**：集成 DeepSeek API，提供智能写作辅助
3. **富文本编辑**：基于 Tiptap，支持表格、图片、代码高亮等
4. **版本历史**：完整的版本管理和恢复功能
5. **离线编辑**：支持离线编辑，自动同步

### 🚀 技术亮点
1. **自定义协作光标**：不依赖官方扩展，完全自主实现
2. **流式 AI 响应**：实时显示 AI 生成内容
3. **上下文感知**：AI 自动理解文档上下文
4. **多模型支持**：支持 DeepSeek、GPT 等多种 AI 模型
5. **性能优化**：虚拟滚动、缓存策略、队列管理

### 💡 创新点
1. **AI + 协同编辑**：将 AI 写作助手与实时协同编辑完美结合
2. **智能提示词**：内置多种写作场景的提示词模板
3. **协同 AI 提示**：在协同编辑中智能提示 AI 建议
4. **快捷指令**：一键续写、改写、扩写、总结、翻译

---

## 备注

- 每章完成后会创建对应的 Git commit
- 教程文档包含详细的理论讲解和代码实现
- 每章都有验证步骤确保实现正确
- 面试考点帮助准备技术面试
- **新增**：AI 写作助手功能，打造智能协同编辑器
- **新增**：DeepSeek API 集成，提供高性价比的 AI 能力

---

## AI 功能规划详情

### 核心 AI 功能（基于原型图）

#### 1. 左右分栏布局
- **左侧（60%）**：富文本编辑器
- **右侧（40%）**：AI 对话面板
- **可调整**：拖拽中间分隔线调整宽度
- **可收起**：右侧面板可以完全收起

#### 2. AI 对话流程
1. **初始状态**：
   - 左侧：空白编辑器或现有文档
   - 右侧：输入框提示"您好，有什么可以帮您？"
   
2. **用户输入**：
   - 在右侧输入框输入需求
   - 点击发送按钮或按 Enter
   
3. **AI 思考中**：
   - 右侧显示"正在思考中"加载状态
   - 左侧编辑器底部显示"思考中..."按钮
   - 可以点击"停止"按钮中断生成
   
4. **流式生成**：
   - 右侧：AI 回复逐字显示
   - 左侧：编辑器内容同步流式输出
   - 实时显示生成进度
   
5. **生成完成**：
   - 右侧：显示完整 AI 回复
   - 左侧：显示完整生成的文档
   - 显示"内容生成完成"提示卡片
   - 提供操作按钮：继续生成、重新生成、撤销

#### 3. 快捷指令系统
- **续写**：根据当前内容继续写作
- **改写**：优化润色选中的内容
- **扩写**：详细展开选中的内容
- **总结**：概括总结选中的内容
- **翻译**：中英文互译

#### 4. 上下文感知
- 自动提取选中内容作为上下文
- 自动提取文档前后文作为上下文
- 智能理解用户意图

### 技术实现方案

#### 1. 后端实现
```typescript
// AI 路由结构
POST /api/ai/chat          // 发送消息，返回流式响应
POST /api/ai/continue      // 续写
POST /api/ai/rewrite       // 改写
POST /api/ai/expand        // 扩写
POST /api/ai/summarize     // 总结
POST /api/ai/translate     // 翻译
GET  /api/ai/models        // 获取可用模型列表
```

**流式响应实现**：
- 使用 Server-Sent Events (SSE)
- 实时推送 AI 生成的内容
- 支持中断和错误处理

#### 2. 前端实现
```typescript
// 组件结构
<EditorLayout>
  <EditorPanel>           // 左侧编辑器
    <TiptapEditor />
    <StreamingIndicator /> // 流式输出指示器
  </EditorPanel>
  
  <ResizableHandle />     // 可拖拽的分隔线
  
  <AIChatPanel>           // 右侧 AI 对话
    <MessageList />       // 消息列表
    <ThinkingIndicator /> // 思考中指示器
    <InputBox />          // 输入框
    <QuickActions />      // 快捷指令按钮
  </AIChatPanel>
</EditorLayout>
```

**流式输出到编辑器**：
```typescript
// 监听 SSE 事件
eventSource.onmessage = (event) => {
  const chunk = event.data
  // 追加到编辑器
  editor.commands.insertContentAt(
    editor.state.doc.content.size,
    chunk
  )
}
```

#### 3. 状态管理
```typescript
interface AIState {
  isGenerating: boolean      // 是否正在生成
  currentMessage: string     // 当前消息
  messages: Message[]        // 消息历史
  selectedModel: string      // 选中的模型
  context: string           // 上下文内容
}
```

### 用户体验设计

#### 1. 加载状态
- **思考中**：显示动画和文字提示
- **生成中**：显示进度和已生成字数
- **完成**：显示完成提示和操作按钮

#### 2. 错误处理
- **网络错误**：显示重试按钮
- **API 错误**：显示错误信息和建议
- **超时**：自动重试或提示用户

#### 3. 交互优化
- **快捷键**：Ctrl+K 快速打开 AI 对话
- **右键菜单**：选中文字右键显示 AI 选项
- **拖拽调整**：平滑的宽度调整动画
- **自动滚动**：生成时自动滚动到底部

### 性能优化

#### 1. 流式渲染优化
- 使用 requestAnimationFrame 批量更新
- 防抖处理频繁的内容更新
- 虚拟滚动处理长消息列表

#### 2. 缓存策略
- 缓存常用的 AI 响应
- 缓存用户的对话历史
- 本地存储用户偏好设置

#### 3. 请求优化
- 请求队列管理，避免并发过多
- 自动重试失败的请求
- Token 使用统计和限流
