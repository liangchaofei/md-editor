# Chapter 29-30 å®Œæˆæ€»ç»“

## å®Œæˆæ—¶é—´
2024-02-02

## å®žçŽ°å†…å®¹

### Chapter 29: å³é”®èœå•å’Œå¿«æ·æ“ä½œ âœ…

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… åˆ›å»º ContextMenu ç»„ä»¶
- âœ… æ™ºèƒ½èœå•é¡¹ï¼ˆæ ¹æ®ä¸Šä¸‹æ–‡æ˜¾ç¤ºï¼‰
- âœ… AI å¿«æ·æ“ä½œï¼ˆæ”¹å†™ã€ç¿»è¯‘ã€æ€»ç»“ã€æ‰©å†™ã€ç¼©å†™ï¼‰
- âœ… æ ¼å¼åŒ–æ“ä½œï¼ˆåŠ ç²—ã€æ–œä½“ã€é«˜äº®ç­‰ï¼‰
- âœ… æ’å…¥æ“ä½œï¼ˆè¡¨æ ¼ã€å›¾ç‰‡ã€é“¾æŽ¥ã€ä»£ç å—ï¼‰
- âœ… ç¼–è¾‘æ“ä½œï¼ˆå¤åˆ¶ã€ç²˜è´´ã€åˆ é™¤ï¼‰
- âœ… ä½ç½®è®¡ç®—å’Œè¾¹ç•Œæ£€æµ‹
- âœ… ç‚¹å‡»å¤–éƒ¨å…³é—­å’Œ ESC å…³é—­

**æ–‡ä»¶æ¸…å•**ï¼š
- `client/src/components/editor/ContextMenu.tsx` (æ–°å»º)
- `client/src/components/editor/TiptapEditor.tsx` (ä¿®æ”¹)
- `docs/chapter-29.md` (æ–°å»º)

---

### Chapter 30: å—çº§ç¼–è¾‘å’Œæ‹–æ‹½æŽ’åº âœ…

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… åˆ›å»º DragHandle ç»„ä»¶ï¼ˆæ‹–æ‹½æ‰‹æŸ„ï¼‰
- âœ… åˆ›å»º DragAndDrop æ‰©å±•ï¼ˆæ‹–æ‹½é€»è¾‘ï¼‰
- âœ… å®žçŽ°æ‹–æ‹½æŽ’åºåŠŸèƒ½
- âœ… å®žçŽ°å—çº§é€‰æ‹©
- âœ… å®žçŽ°å—çº§æ“ä½œèœå•ï¼ˆåˆ é™¤ã€å¤åˆ¶ï¼‰
- âœ… é›†æˆ Dropcursor æ‰©å±•ï¼ˆæ‹–æ‹½æŒ‡ç¤ºå™¨ï¼‰
- âœ… å®žçŽ°è‡ªåŠ¨æ˜¾ç¤º/éšè—æ‰‹æŸ„
- âœ… å®žçŽ°ä½ç½®è®¡ç®—å’Œè¾¹ç•Œæ£€æµ‹

**æ–‡ä»¶æ¸…å•**ï¼š
- `client/src/components/editor/DragHandle.tsx` (æ–°å»º)
- `client/src/extensions/DragAndDrop.ts` (æ–°å»º)
- `client/src/components/editor/TiptapEditor.tsx` (ä¿®æ”¹)
- `docs/chapter-30.md` (æ–°å»º)

**ä¾èµ–**ï¼š
- `@tiptap/extension-dropcursor` (å·²å®‰è£…)

---

## æŠ€æœ¯äº®ç‚¹

### Chapter 29: å³é”®èœå•

1. **æ™ºèƒ½èœå•é¡¹**
   - æ ¹æ®æ˜¯å¦æœ‰é€‰ä¸­æ–‡æœ¬æ˜¾ç¤ºä¸åŒé€‰é¡¹
   - æœ‰é€‰ä¸­æ–‡æœ¬ï¼šAI æ“ä½œ + æ ¼å¼åŒ– + ç¼–è¾‘
   - æ— é€‰ä¸­æ–‡æœ¬ï¼šæ’å…¥æ“ä½œ + ç²˜è´´ + å…¨é€‰

2. **ä½ç½®è®¡ç®—**
   - è‡ªåŠ¨è°ƒæ•´é¿å…è¶…å‡ºå±å¹•
   - è¾¹ç•Œæ£€æµ‹ï¼ˆä¸Šä¸‹å·¦å³ï¼‰
   - æ™ºèƒ½å®šä½

3. **äº‹ä»¶å¤„ç†**
   - é˜»æ­¢é»˜è®¤å³é”®èœå•
   - ç‚¹å‡»å¤–éƒ¨å…³é—­
   - ESC é”®å…³é—­

### Chapter 30: å—çº§ç¼–è¾‘

1. **æ‹–æ‹½æ‰‹æŸ„æ˜¾ç¤º**
   - é¼ æ ‡æ‚¬æµ®æ®µè½æ—¶æ˜¾ç¤º
   - åž‚ç›´å±…ä¸­å¯¹é½æ®µè½
   - é¼ æ ‡ç§»åˆ°æ‰‹æŸ„ä¸Šä¿æŒæ˜¾ç¤º
   - ç®€åŒ–çš„äº‹ä»¶ç›‘å¬é€»è¾‘

2. **æ‹–æ‹½æŽ’åº**
   - HTML5 Drag and Drop API
   - æ‹–æ‹½æŒ‡ç¤ºå™¨ï¼ˆè“è‰²çº¿æ¡ï¼‰
   - èŠ‚ç‚¹ç§»åŠ¨ç®—æ³•
   - ä½ç½®è®¡ç®—ä¼˜åŒ–

3. **å—çº§æ“ä½œ**
   - ç‚¹å‡»æ‰‹æŸ„é€‰ä¸­æ•´ä¸ªå—
   - åˆ é™¤å—
   - å¤åˆ¶å—
   - æ“ä½œèœå•

---

## è°ƒè¯•è¿‡ç¨‹

### é‡åˆ°çš„é—®é¢˜

1. **æ‰‹æŸ„ä½ç½®ä¸å¯¹**
   - é—®é¢˜ï¼šæ‰‹æŸ„æ˜¾ç¤ºåœ¨å·¦ä¾§èœå•åŒºåŸŸ
   - è§£å†³ï¼šä½¿ç”¨ `rect.left - 28` è®¡ç®—ä½ç½®

2. **æ‰‹æŸ„å›¾æ ‡å¤ªå¤§**
   - é—®é¢˜ï¼šå›¾æ ‡å’Œè¾¹æ¡†å¤ªæ˜Žæ˜¾
   - è§£å†³ï¼šæ”¹ä¸º `w-4 h-4`ï¼ŒåŽ»æŽ‰è¾¹æ¡†

3. **é¼ æ ‡æ‚¬æµ®æ‰‹æŸ„åŽæ¶ˆå¤±**
   - é—®é¢˜ï¼šäº‹ä»¶ç›‘å¬é€»è¾‘å¤æ‚ï¼ŒçŠ¶æ€ç®¡ç†æ··ä¹±
   - è§£å†³ï¼šå®Œå…¨é‡å†™ï¼Œä½¿ç”¨ç®€å•çš„é€»è¾‘
   - å…³é”®ï¼šåœ¨ document ä¸Šç›‘å¬ï¼Œæ£€æŸ¥ `handleRef.current?.contains(target)`

4. **æ‹–æ‹½åŽæ‰‹æŸ„å¼‚å¸¸**
   - é—®é¢˜ï¼šæ‹–æ‹½åŽæ‰‹æŸ„è¡Œä¸ºä¸æ­£å¸¸
   - è§£å†³ï¼šæ·»åŠ  `onDragEnd` äº‹ä»¶ï¼Œæ‹–æ‹½ç»“æŸåŽéšè—æ‰‹æŸ„

### æœ€ç»ˆæ–¹æ¡ˆ

**ç®€åŒ–çš„ DragHandle å®žçŽ°**ï¼š
```typescript
// 1. åªç›‘å¬ document çš„ mousemove
document.addEventListener('mousemove', handleMouseMove)

// 2. ç®€å•çš„æ‰‹æŸ„æ£€æµ‹
if (handleRef.current?.contains(target)) {
  return // ä¿æŒæ˜¾ç¤º
}

// 3. ä¿ç•™å½“å‰å—ï¼Œæ£€æŸ¥å·¦ä¾§åŒºåŸŸ
if (currentBlock) {
  const rect = currentBlock.getBoundingClientRect()
  if (e.clientX >= rect.left - 40 && e.clientX <= rect.left &&
      e.clientY >= rect.top && e.clientY <= rect.bottom) {
    return // ä¿æŒæ˜¾ç¤º
  }
}
```

---

## ç”¨æˆ·ä½“éªŒ

### Chapter 29: å³é”®èœå•

**ä¼˜ç‚¹**ï¼š
- å¿«é€Ÿè®¿é—®å¸¸ç”¨æ“ä½œ
- æ™ºèƒ½æ˜¾ç¤ºç›¸å…³é€‰é¡¹
- ä¸Ž AI åŠŸèƒ½æ— ç¼é›†æˆ
- ç¬¦åˆç”¨æˆ·ä¹ æƒ¯

**ä½¿ç”¨åœºæ™¯**ï¼š
- é€‰ä¸­æ–‡å­— â†’ å³é”® â†’ AI æ”¹å†™
- ç©ºç™½å¤„ â†’ å³é”® â†’ æ’å…¥è¡¨æ ¼
- é€‰ä¸­æ–‡å­— â†’ å³é”® â†’ æ ¼å¼åŒ–

### Chapter 30: å—çº§ç¼–è¾‘

**ä¼˜ç‚¹**ï¼š
- Notion é£Žæ ¼çš„äº¤äº’
- ç›´è§‚çš„æ‹–æ‹½æŽ’åº
- å¿«é€Ÿçš„å—çº§æ“ä½œ
- æµç•…çš„åŠ¨ç”»æ•ˆæžœ

**ä½¿ç”¨åœºæ™¯**ï¼š
- è°ƒæ•´æ®µè½é¡ºåº
- å¿«é€Ÿåˆ é™¤æ®µè½
- å¤åˆ¶æ®µè½å†…å®¹
- é‡ç»„æ–‡æ¡£ç»“æž„

---

## æµ‹è¯•éªŒè¯

### Chapter 29 æµ‹è¯•

- [x] é€‰ä¸­æ–‡å­—å³é”®æ˜¾ç¤ºèœå•
- [x] ç©ºç™½å¤„å³é”®æ˜¾ç¤ºèœå•
- [x] AI æ“ä½œæ­£å¸¸è§¦å‘
- [x] æ ¼å¼åŒ–æ“ä½œæ­£å¸¸
- [x] æ’å…¥æ“ä½œæ­£å¸¸
- [x] èœå•ä½ç½®æ­£ç¡®
- [x] ç‚¹å‡»å¤–éƒ¨å…³é—­
- [x] ESC å…³é—­

### Chapter 30 æµ‹è¯•

- [x] é¼ æ ‡æ‚¬æµ®æ˜¾ç¤ºæ‰‹æŸ„
- [x] æ‰‹æŸ„ä½ç½®æ­£ç¡®ï¼ˆåž‚ç›´å±…ä¸­ï¼‰
- [x] é¼ æ ‡ç§»åˆ°æ‰‹æŸ„ä¸Šä¸æ¶ˆå¤±
- [x] æ‹–æ‹½æŽ’åºæ­£å¸¸
- [x] æ‹–æ‹½æŒ‡ç¤ºå™¨æ˜¾ç¤º
- [x] ç‚¹å‡»æ‰‹æŸ„é€‰ä¸­å—
- [x] åˆ é™¤å—æ­£å¸¸
- [x] å¤åˆ¶å—æ­£å¸¸
- [x] æ‹–æ‹½åŽæ‰‹æŸ„æ­£å¸¸

---

## ä»£ç ç»Ÿè®¡

### æ–°å¢žæ–‡ä»¶

**Chapter 29**ï¼š
- `client/src/components/editor/ContextMenu.tsx` (~300 è¡Œ)
- `docs/chapter-29.md` (~800 è¡Œ)

**Chapter 30**ï¼š
- `client/src/components/editor/DragHandle.tsx` (~200 è¡Œ)
- `client/src/extensions/DragAndDrop.ts` (~70 è¡Œ)
- `docs/chapter-30.md` (~800 è¡Œ)

**æ€»è®¡**ï¼š
- ä»£ç ï¼š~570 è¡Œ
- æ–‡æ¡£ï¼š~1600 è¡Œ

### ä¿®æ”¹æ–‡ä»¶

- `client/src/components/editor/TiptapEditor.tsx`
  - æ·»åŠ å³é”®èœå•ç›‘å¬
  - æ·»åŠ  DragHandle ç»„ä»¶
  - æ·»åŠ  DragAndDrop æ‰©å±•
  - æ·»åŠ  Dropcursor æ‰©å±•

---

## åŽç»­ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸ

1. **å³é”®èœå•å¢žå¼º**
   - å­èœå•æ”¯æŒ
   - æ›´å¤š AI æ“ä½œ
   - è‡ªå®šä¹‰èœå•é¡¹

2. **å—çº§ç¼–è¾‘å¢žå¼º**
   - å¤šé€‰æ”¯æŒï¼ˆShift+ç‚¹å‡»ï¼‰
   - æ‰¹é‡æ“ä½œ
   - æ‹–æ‹½é¢„è§ˆä¼˜åŒ–

3. **æ€§èƒ½ä¼˜åŒ–**
   - äº‹ä»¶èŠ‚æµ
   - è™šæ‹Ÿæ»šåŠ¨
   - ç¼“å­˜ä¼˜åŒ–

### ä¸­æœŸ

1. **è·¨æ–‡æ¡£æ‹–æ‹½**
   - æ‹–æ‹½åˆ°å…¶ä»–æ–‡æ¡£
   - æ‹–æ‹½åˆ°ä¾§è¾¹æ 

2. **å—çº§è½¬æ¢**
   - æ®µè½ â†’ æ ‡é¢˜
   - åˆ—è¡¨ â†’ æ®µè½
   - å¿«æ·è½¬æ¢èœå•

3. **æ’¤é”€/é‡åšä¼˜åŒ–**
   - æ‹–æ‹½æ“ä½œå¯æ’¤é”€
   - æ‰¹é‡æ“ä½œåˆå¹¶

---

## æäº¤ä»£ç 

```bash
git add .
git commit -m "feat: å®žçŽ°å³é”®èœå•å’Œå—çº§ç¼–è¾‘ï¼ˆChapter 29-30ï¼‰

Chapter 29: å³é”®èœå•å’Œå¿«æ·æ“ä½œ
- åˆ›å»º ContextMenu ç»„ä»¶
- å®žçŽ°æ™ºèƒ½èœå•é¡¹ï¼ˆæ ¹æ®ä¸Šä¸‹æ–‡æ˜¾ç¤ºï¼‰
- é›†æˆ AI å¿«æ·æ“ä½œï¼ˆæ”¹å†™ã€ç¿»è¯‘ã€æ€»ç»“ã€æ‰©å†™ï¼‰
- é›†æˆæ ¼å¼åŒ–æ“ä½œï¼ˆåŠ ç²—ã€æ–œä½“ã€é«˜äº®ç­‰ï¼‰
- é›†æˆæ’å…¥æ“ä½œï¼ˆè¡¨æ ¼ã€å›¾ç‰‡ã€é“¾æŽ¥ã€ä»£ç å—ï¼‰
- å®žçŽ°ä½ç½®è®¡ç®—å’Œè¾¹ç•Œæ£€æµ‹
- å®žçŽ°ç‚¹å‡»å¤–éƒ¨å…³é—­å’Œ ESC å…³é—­

Chapter 30: å—çº§ç¼–è¾‘å’Œæ‹–æ‹½æŽ’åº
- åˆ›å»º DragHandle ç»„ä»¶ï¼ˆæ‹–æ‹½æ‰‹æŸ„ï¼‰
- åˆ›å»º DragAndDrop æ‰©å±•ï¼ˆæ‹–æ‹½é€»è¾‘ï¼‰
- å®žçŽ°æ‹–æ‹½æŽ’åºåŠŸèƒ½
- å®žçŽ°å—çº§é€‰æ‹©
- å®žçŽ°å—çº§æ“ä½œèœå•ï¼ˆåˆ é™¤ã€å¤åˆ¶ï¼‰
- é›†æˆ Dropcursor æ‰©å±•ï¼ˆæ‹–æ‹½æŒ‡ç¤ºå™¨ï¼‰
- å®žçŽ°è‡ªåŠ¨æ˜¾ç¤º/éšè—æ‰‹æŸ„
- ä¼˜åŒ–äº‹ä»¶ç›‘å¬é€»è¾‘

æ–°å»ºæ–‡ä»¶ï¼š
- client/src/components/editor/ContextMenu.tsx
- client/src/components/editor/DragHandle.tsx
- client/src/extensions/DragAndDrop.ts
- docs/chapter-29.md
- docs/chapter-30.md

ä¿®æ”¹æ–‡ä»¶ï¼š
- client/src/components/editor/TiptapEditor.tsx

ä¾èµ–ï¼š
- @tiptap/extension-dropcursor"
```

---

## æ€»ç»“

Chapter 29 å’Œ 30 æˆåŠŸå®žçŽ°äº†ç¼–è¾‘å™¨çš„å³é”®èœå•å’Œå—çº§ç¼–è¾‘åŠŸèƒ½ï¼Œä¸ºç”¨æˆ·æä¾›äº†æ›´åŠ ä¾¿æ·å’Œç›´è§‚çš„æ“ä½œä½“éªŒã€‚

**æ ¸å¿ƒæˆæžœ**ï¼š
- âœ… å³é”®èœå•ï¼šå¿«é€Ÿè®¿é—®å¸¸ç”¨æ“ä½œ
- âœ… å—çº§ç¼–è¾‘ï¼šNotion é£Žæ ¼çš„æ‹–æ‹½æŽ’åº
- âœ… æ™ºèƒ½äº¤äº’ï¼šæ ¹æ®ä¸Šä¸‹æ–‡æ˜¾ç¤ºä¸åŒé€‰é¡¹
- âœ… æµç•…ä½“éªŒï¼šå¹³æ»‘çš„åŠ¨ç”»å’Œåé¦ˆ

**æŠ€æœ¯æ”¶èŽ·**ï¼š
- å³é”®èœå•å®žçŽ°å’Œä½ç½®è®¡ç®—
- HTML5 æ‹–æ‹½ API ä½¿ç”¨
- äº‹ä»¶ç›‘å¬ä¼˜åŒ–
- çŠ¶æ€ç®¡ç†ç®€åŒ–

**é¡¹ç›®è¿›åº¦**ï¼š
- æ€»ç« èŠ‚ï¼š30 ç« 
- å·²å®Œæˆï¼š30 ç« 
- å®Œæˆåº¦ï¼š100% âœ…

---

**ä¸‹ä¸€æ­¥**ï¼š
- æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
- ä¼˜åŒ–æ€§èƒ½
- å‡†å¤‡éƒ¨ç½²

ðŸŽ‰ æ­å–œå®Œæˆ Chapter 29-30ï¼
