# 第33章 - AI 对话面板优化进度

## 已完成

### 1. 优化方案设计 ✅
- 创建了完整的优化方案文档 (`CHAPTER_33_AI_PANEL_OPTIMIZATION_PLAN.md`)
- 明确了所有优化点和实现步骤

### 2. 基础类型更新 ✅
- 更新 `Message` 类型，添加 `stats` 字段用于存储统计信息
- 添加 `DEFAULT_MODEL` 常量
- 添加 `getDefaultModel()` 函数
- 添加 `supportsDeepThink()` 函数

## 待实现

### 1. AIChatPanel 头部优化
- [ ] 移除"AI 写作助手"标题
- [ ] 移除"正在思考中..."状态
- [ ] 移除生成模式切换按钮
- [ ] 移除 Token 统计按钮
- [ ] 移除调试按钮
- [ ] 保留：清空历史、模型选择、关闭按钮

### 2. 模式切换移到输入框上方
- [ ] 在输入框上方添加模式切换按钮
- [ ] 样式与首页保持一致

### 3. 深度思考逻辑优化
- [ ] 根据模型自动显示/隐藏深度思考开关
- [ ] 切换模型时自动关闭深度思考（如果不支持）
- [ ] 首页使用默认模型 + 深度思考开关

### 4. Token 统计显示优化
- [ ] 在消息发送时记录开始时间
- [ ] 在消息完成时计算耗时、Token、费用
- [ ] 在每条 AI 消息下方显示统计信息
- [ ] 格式：⏱️ 耗时 3.2s  📊 256 tokens  💰 ¥0.01

### 5. MessageItem 组件优化
- [ ] 添加统计信息显示
- [ ] 优化消息卡片样式
- [ ] 添加过渡动画

### 6. 首页模型逻辑
- [ ] 使用 DEFAULT_MODEL 作为默认模型
- [ ] 深度思考开关启用时自动切换到 deepseek-reasoner

## 优化效果预览

### 优化前
```
┌─────────────────────────────────────────────────────────┐
│ 🔮 AI 写作助手  正在思考中...                            │
│ [全文生成|分段生成] [📊] [🗑️] [🐛] [模型▼] [✕]          │
├─────────────────────────────────────────────────────────┤
│ 消息列表...                                              │
├─────────────────────────────────────────────────────────┤
│ 输入框...                                                │
│ [深度思考] [发送]                                        │
└─────────────────────────────────────────────────────────┘
```

### 优化后
```
┌─────────────────────────────────────────────────────────┐
│ [模型▼] [🗑️] [✕]                                        │  ← 简化的头部
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 消息列表...                                              │  ← 更大的空间
│                                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ AI 消息内容...                                       │ │
│ │ ⏱️ 3.2s  📊 256 tokens  💰 ¥0.01                    │ │  ← Token 统计
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
├─────────────────────────────────────────────────────────┤
│ [分段生成] [深度思考]                                    │  ← 模式选择
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 输入框...                                            │ │
│ └─────────────────────────────────────────────────────┘ │
│                                              [发送]     │
└─────────────────────────────────────────────────────────┘
```

## 下一步

继续实现 AIChatPanel 的优化，包括：
1. 头部简化
2. 模式切换移动
3. 深度思考逻辑
4. Token 统计显示
5. 编写第33章教程
